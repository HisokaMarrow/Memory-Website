<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Memoro</title>

  <!-- Global styles -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style/style.css" />

  <!-- Header-specific styles -->
  <link rel="stylesheet" href="/style/header.css" />

  <!-- Footer-specific styles -->
  <link rel="stylesheet" href="/style/footer.css" />
</head>
<body>

<script>
  // Load reusable header from components/header.html
  fetch('components/header.html')
    .then(res => res.text())
    .then(data => {
      // Inject the header at the top of the body
      document.body.insertAdjacentHTML('afterbegin', data);

      // === After header is injected ===

      // Create and insert backdrop
      const backdropEl = document.createElement('div');
      backdropEl.classList.add('nav-backdrop');
      document.body.appendChild(backdropEl);

      // Query the toggle button and the nav drawer
      const toggleBtn = document.querySelector('.mobile-nav-toggle');
      const menu = document.querySelector('.header-menu');

      // Safety check
      if (!toggleBtn || !menu) {
        console.warn("Header elements not found. Check class names in header.html");
        return;
      }

      // Toggle drawer and backdrop visibility
      const toggleMenu = () => {
        toggleBtn.classList.toggle('open');    // Animate hamburger to X
        menu.classList.toggle('open');         // Slide drawer open/closed
        backdropEl.classList.toggle('active'); // Dim background
      };

      // Event listeners
      toggleBtn.addEventListener('click', toggleMenu);
      backdropEl.addEventListener('click', toggleMenu); // close menu when clicking outside
    })
    .catch(err => console.error('Failed to load header:', err));
</script>


<main class="main-container">
  <h1 class="main-title" style="text-align: center;">Your Progress</h1>

  <div id="game-buttons" class="radio-group" style="justify-content: center;">
    <!-- Dynamic Buttons will be generated here -->
  </div>

  <h2 id="graph-heading" class="main-title" style="text-align: center; margin-top: 2rem;">Progress for Numbers Game</h2>

  <div style="margin-top: 2rem;">
    <canvas id="progressChart" style="max-width: 100%; height: 400px;"></canvas>
  </div>

</main>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Games List: From the JSON you provided
const gamesList = [
  { id: "memory_number", title: "Number Memory" },
  { id: "memory_words", title: "Word Memory" },
  { id: "memory_cards", title: "Card Challenge" },
  { id: "math_addition", title: "Addition Master" },
  { id: "math_subtraction", title: "Subtraction Master" },
  { id: "math_multiplication", title: "Multiplication Master" },
  { id: "math_division", title: "Division Master" },
  { id: "math_percentage", title: "Percentage Master" },
  { id: "math_doomsday", title: "Doomsday Master" },
  { id: "riddle_logic", title: "Logic Riddles" },
];

// Generate dynamic buttons for each game
function generateGameButtons() {
  const gameButtonsContainer = document.getElementById("game-buttons");
  gamesList.forEach(game => {
    const button = document.createElement("button");
    button.classList.add("game-results-buttons");
    button.textContent = game.title;
    button.onclick = () => updateGraph(game.id);
    gameButtonsContainer.appendChild(button);
  });
}

let chartInstance = null;

// Function to update graph when a button is clicked
function updateGraph(selectedGame) {
  const allSessions = JSON.parse(localStorage.getItem("gameSessions") || "[]");
  const filteredSessions = allSessions.filter(s => s.gameType === selectedGame);

  // Update heading dynamically based on selected game
  const selectedGameTitle = gamesList.find(game => game.id === selectedGame).title;
  document.getElementById("graph-heading").textContent = `Progress for ${selectedGameTitle}`;

  const ctx = document.getElementById('progressChart').getContext('2d');

  // Destroy old chart if it exists
  if (chartInstance) {
    chartInstance.destroy();
  }

  if (filteredSessions.length === 0) {
    chartInstance = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['No Data'],
        datasets: [{
          label: 'No Sessions Found',
          data: [0],
          backgroundColor: 'rgba(150, 150, 150, 0.2)',
          borderColor: 'rgba(150, 150, 150, 0.6)',
          borderWidth: 2
        }]
      },
      options: {
        scales: {
          y: { min: 0, max: 100 }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });
    return;
  }

  const labels = filteredSessions.map(s => `${s.date} ${s.time}`);
  const dataPoints = filteredSessions.map(s => s.scorePercent);

  chartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Score %',
        data: dataPoints,
        backgroundColor: 'rgba(124, 58, 237, 0.4)', // nice violet
        borderColor: 'rgba(124, 58, 237, 1)',
        borderWidth: 2,
        fill: true,
        tension: 0.3,
        pointBackgroundColor: 'white',
        pointBorderColor: 'rgba(124, 58, 237, 1)',
        pointRadius: 4,
      }]
    },
    options: {
      scales: {
        y: {
          min: 0,
          max: 100,
          ticks: { stepSize: 10 },
          grid: {
            color: 'rgba(255,255,255,0.1)'
          }
        },
        x: {
          grid: {
            color: 'rgba(255,255,255,0.05)'
          }
        }
      },
      plugins: {
        legend: {
          labels: {
            color: '#e6e8eb', // match your site's light font
            font: { size: 14 }
          }
        }
      }
    }
  });
}

// Show "Numbers" by default on page load
window.onload = () => {
  generateGameButtons();  // Load game buttons
  updateGraph('memory_number');  // Show "Numbers" data by default
};
</script>


<!-- Footer -->
<div id="site-footer"></div>
<script>
  // Load reusable footer after its CSS is already in place
  fetch('/components/footer.html')
    .then(res => res.text())
    .then(html => {
      document.getElementById('site-footer').innerHTML = html;
    })
    .catch(err => console.error('Failed to load footer:', err));
</script>

</body>
</html>

