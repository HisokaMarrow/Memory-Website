<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Memoro</title>

  <!-- Fonts & Global styles -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style/style.css" />
  <link rel="stylesheet" href="/style/header.css" />
  <link rel="stylesheet" href="/style/footer.css" />

  <!-- Fade-in animation -->
  <link rel="stylesheet" href="/style/intro.css" />
  <script defer src="/scripts/global-fade-in.js"></script>
</head>
<body>
  <div style="min-height: 80px"></div> <!-- Prevent header shift -->

  <!-- Inject Header -->
  <script>
    fetch('components/header.html')
      .then(res => res.text())
      .then(data => {
        document.body.insertAdjacentHTML('afterbegin', data);
        const backdropEl = document.createElement('div');
        backdropEl.classList.add('nav-backdrop');
        document.body.appendChild(backdropEl);

        const toggleBtn = document.querySelector('.mobile-nav-toggle');
        const menu = document.querySelector('.header-menu');

        if (!toggleBtn || !menu) return;

        const toggleMenu = () => {
          toggleBtn.classList.toggle('open');
          menu.classList.toggle('open');
          backdropEl.classList.toggle('active');
        };

        toggleBtn.addEventListener('click', toggleMenu);
        backdropEl.addEventListener('click', toggleMenu);
      })
      .catch(err => console.error('Failed to load header:', err));
  </script>

  <!-- Main Content -->
  <main class="main-games-wrapper fade-in-on-load">

    <!-- Memory Games -->
    <section class="game-section memory">
      <h2><a href="/memory.html" class="main-section-link">Memory Games ></a></h2>
      <div class="carousel-wrapper">
        <button class="carousel-arrow left" data-target="memory-carousel">&lt;</button>
        <div class="main-carousel" id="memory-carousel"></div>
        <button class="carousel-arrow right" data-target="memory-carousel">&gt;</button>
      </div>
    </section>

    <!-- Math Games -->
    <section class="game-section math">
      <h2><a href="/maths.html" class="main-section-link">Math Games ></a></h2>
      <div class="carousel-wrapper">
        <button class="carousel-arrow left" data-target="math-carousel">&lt;</button>
        <div class="main-carousel" id="math-carousel"></div>
        <button class="carousel-arrow right" data-target="math-carousel">&gt;</button>
      </div>
    </section>

    <!-- Riddle Games -->
    <section class="game-section riddles">
      <h2><a href="/riddles.html" class="main-section-link">Riddle Games ></a></h2>
      <div class="carousel-wrapper">
        <button class="carousel-arrow left" data-target="riddle-carousel">&lt;</button>
        <div class="main-carousel" id="riddle-carousel"></div>
        <button class="carousel-arrow right" data-target="riddle-carousel">&gt;</button>
      </div>
    </section>

  </main>

  <!-- Game Loader Script -->
  <script>
    function createGameBox(game) {
      const box = document.createElement("div");
      box.className = "game-cards";
      box.innerHTML = `
        <h3>${game.title}</h3>
        <p>${game.description}</p>
        ${game.link?.trim() ? `<a href="${game.link}" class="main-button">Play</a>` : `<a class="main-button disabled">Coming Soon</a>`}
      `;
      return box;
    }

    function renderGames(games) {
      const containers = {
        Memory: document.getElementById("memory-carousel"),
        Math: document.getElementById("math-carousel"),
        Riddles: document.getElementById("riddle-carousel")
      };

      games.forEach(game => {
        const section = containers[game.category];
        if (section) section.appendChild(createGameBox(game));
      });
    }

    fetch('/gamescollection/games.json')
      .then(res => res.json())
      .then(renderGames)
      .catch(err => console.error("Failed to load games:", err));
  </script>

  <!-- Carousel Controls -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.carousel-wrapper').forEach(wrapper => {
        const carousel = wrapper.querySelector('.main-carousel');
        const left = wrapper.querySelector('.carousel-arrow.left');
        const right = wrapper.querySelector('.carousel-arrow.right');
        const scrollAmount = 320;

        left?.addEventListener('click', () => carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' }));
        right?.addEventListener('click', () => carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' }));
      });
    });
  </script>

  <!-- Footer -->
  <div id="site-footer"></div>
  <script>
    fetch('/components/footer.html')
      .then(res => res.text())
      .then(html => {
        document.getElementById('site-footer').innerHTML = html;
      })
      .catch(err => console.error('Failed to load footer:', err));
  </script>
</body>
</html>
